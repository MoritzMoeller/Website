<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Traffic Light Predictor</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        ul { list-style-type: none; padding: 0; }
        li { cursor: pointer; padding: 10px; border: 1px solid #ddd; margin-bottom: 5px; }
        #lightPredictor { display: none; }
        #colorIndicator { width: 100px; height: 100px; margin: 20px 0; }
        button { margin-top: 10px; }
    </style>
</head>
<body>
    <div id="trafficLightList">
        <h1>Traffic Lights</h1>
        <ul id="lightsList"></ul>
    </div>

    <div id="lightPredictor">
        <h1 id="lightName"></h1>
        <div id="colorIndicator"></div>
        <p>Current color: <span id="currentColor"></span></p>
        <p>Time until next change: <span id="timeUntilChange"></span> seconds</p>
        <button onclick="goBack()">Back to List</button>
    </div>

    <script>
        const trafficLights = [
            { name: "Wrangel & Skalitzer (Auto)", direction: "SE", startTime: new Date("2024-10-13T13:10:40Z").getTime(), sequence: ["green", "yellow", "red", "yellow"], intervals: [22000, 3000, 44000, 1000] },
            { name: "Wrangel & Skalitzer (Fußgänger)", direction: "SE", startTime: new Date("2024-10-13T13:09:27Z").getTime(), sequence: ["green", "red"], intervals: [26000, 44000] },
            { name: "Skalitzer & Wrangel (Fußgänger)", direction: "NE", startTime: new Date("2024-10-13T13:11:16Z").getTime(), sequence: ["green", "red"], intervals: [20000, 50000] },
            { name: "Marienburger & Prenzlauer (Fußgänger)", direction: "SE", startTime: new Date("2024-10-13T12:35:32Z").getTime(), sequence: ["red", "green"], intervals: [70000, 10000] },
            { name: "Marienburger & Prenzlauer (Auto)", direction: "SE", startTime: new Date("2024-10-13T12:35:34Z").getTime(), sequence: ["red", "yellow", "green", "yellow"], intervals: [62000, 1000, 13000, 4000] },
        ];

        function displayLightsList() {
            const lightsList = document.getElementById("lightsList");
            lightsList.innerHTML = "";
            trafficLights.forEach((light, index) => {
                const li = document.createElement("li");
                li.textContent = `${light.name} (${light.direction})`;
                li.onclick = () => showLightPredictor(index);
                lightsList.appendChild(li);
            });
        }

        function showLightPredictor(index) {
            const light = trafficLights[index];
            document.getElementById("trafficLightList").style.display = "none";
            document.getElementById("lightPredictor").style.display = "block";
            document.getElementById("lightName").textContent = `${light.name} (${light.direction})`;
            updateLightStatus(light);
            setInterval(() => updateLightStatus(light), 100);
        }

        function updateLightStatus(light) {
            const now = new Date().getTime();
            const totalCycleTime = light.intervals.reduce((a, b) => a + b, 0);
            const elapsedTime = (now - light.startTime) % totalCycleTime;
            
            let accumulatedTime = 0;
            let currentColor;
            let timeUntilChange;
                        
            for (let i = 0; i < light.sequence.length; i++) {
                if (accumulatedTime + light.intervals[i] > elapsedTime) {
                    currentColor = light.sequence[i];
                    timeUntilChange = (accumulatedTime + light.intervals[i] - elapsedTime)/1000;
                    break;
                }
                accumulatedTime += light.intervals[i];
            }

            document.getElementById("colorIndicator").style.backgroundColor = currentColor;
            document.getElementById("currentColor").textContent = currentColor;
            document.getElementById("timeUntilChange").textContent = timeUntilChange;
        }

        function goBack() {
            document.getElementById("trafficLightList").style.display = "block";
            document.getElementById("lightPredictor").style.display = "none";
        }

        displayLightsList();
    </script>
</body>
</html>